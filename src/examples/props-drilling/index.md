Всім привіт, вітаю вас на каналі React для початківців. Мене звати Віталій Рубан, я працюю в компанії Itera і сьогодні у нас рубрика React Code Smells в якій ми поговоримо про такий популярний антипаттерн в реакт застосунках - як props drilling, або глибока передача пропсів.

Спочатку давайте розберемося в чому саме полягає проблема з props drilling і чому її так не люблять.

Перша причина - не зручність. Давайте поглянемо на приклад.

Зараз ви бачите компонент APP в якому ми отримуємо об'єкт з даними користувача і передаємо його далі в layout. Layout, в свою чергу, передає частини об'єкту user далі в підкомпоненти - в navigation, body та footer. Body, в свою чергу передає об'єкт operations далі в компонент Operations.

Тепер давайте уявимо що наш бекенд було розширено і у нас з'явилося додаткове поле `totalAmount`, яке потрібно відобразити в компоненті Operations. Давайте подивимось що нам для цього буде потрібно зробити:

---

Як бачите - дуже не зручно. Але окрім не зручності є ще одна проблема - нам довелося змінити компонент, якому властивість totalAmount взагалі не потрібна - body. Це робить компонент body вразливим і схильним до появи помилок, адже ми завжди можемо десь помилитися чи забути оновити пропс.

Ну а тепер уявіть собі що глибина нашого дерева компонент не 3 компоненти, а, хоча б 5-6, а може й 10-15. Страждання та баги в такому підході нам гарантовані.

Як цьому запобігти?

замість очевидних властивостей, таких як age або name вам доведеться мати справи з більш складною та не очевидною структурою. Окремий біль з'явиться якщо ви будете використовувати TypeScript - для тестування вам доведеться передавати всю структуру замість кількох параметрів що не зручно.

Тому замість цього ми використаємо декілька технік для того щоб подолати проблему props drilling. 

Перша техніка - застосувати children. Якщо подивитися на наш layout - можна побачити що він відповідає за надто багато речей - і відмальовує лайут і знає про контент всередині. Цілком логічно буде переписати його за допомогою children

Як бачите ми прибрали один рівень вкладеності і до того ж спростили наш компонент layout. 

Друга техніка - використати контекст. Наші дані малозмінні, потрібні по всьому застосунку, тож використати контекст буде чудовою ідею. 

Для цього створимо context та передамо значення користувача